name: Lambda Deploy - auth-refresh

on:
  push:
    branches:
      - main
    paths:
      - "backend/lambda/auth_refresh/**"
      - ".github/workflows/lambda-auth-refresh-deploy.yml"
      - ".github/workflows/lambda-deploy-reusable.yml"
  workflow_dispatch:
    inputs:
      reason:
        description: "Why this deploy is being triggered"
        type: string
        required: false
        default: "manual deploy"

permissions:
  contents: read
  id-token: write

jobs:
  deploy:
    uses: ./.github/workflows/lambda-deploy-reusable.yml
    with:
      function_name: "auth-refresh"
      lambda_dir: "backend/lambda/auth_refresh"
      force_static_credentials: true
    secrets:
      AWS_BACKEND_ROLE_TO_ASSUME: ${{ secrets.AWS_BACKEND_ROLE_TO_ASSUME }}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      COORDINATION_INTERNAL_API_KEY: ${{ secrets.COORDINATION_INTERNAL_API_KEY }}
      GH_APP_ID: ${{ secrets.GH_APP_ID }}
      GH_INSTALLATION_ID: ${{ secrets.GH_INSTALLATION_ID }}
